<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integrated Soil Compaction Problem ‚Äî Randomized + Google Sheet Submit</title>

<style>
    body { font-family: Arial, sans-serif; background:#eef6f7; padding:20px; }
    h1 { color:#023047; }
    .box { background:white; padding:20px; border-radius:12px; margin-bottom:25px; box-shadow:0 0 10px #ccc; }
    .quiz-box { background:#caf0f8; padding:15px; border-radius:10px; margin-top:10px; }
    input[type="number"], input[type="text"] { width:200px; padding:6px; margin-bottom:10px; }
    button { background:#0077b6; color:white; padding:10px 16px; border:none; border-radius:8px; cursor:pointer; margin-right:10px; }
    button:hover { background:#005f86; }
</style>

<script>
// =====================================================
// =============== RANDOM VALUE GENERATOR ===============
// =====================================================
function generateIntegratedProblem() {

    let bulkDensity = (1.10 + Math.random()*0.60).toFixed(2);
    let particleDensity = (2.55 + Math.random()*0.15).toFixed(2);
    let coneForce = (300 + Math.random()*500).toFixed(0);
    let coneArea = 3.14;
    let wheelLoad = (800 + Math.random()*400).toFixed(0);
    let contactArea = (120 + Math.random()*80).toFixed(0);

    document.getElementById("bd_val").innerText = bulkDensity;
    document.getElementById("pd_val").innerText = particleDensity;
    document.getElementById("cf_val").innerText = coneForce;
    document.getElementById("wl_val").innerText = wheelLoad;
    document.getElementById("ca_val").innerText = contactArea;

    let porosity = (1 - bulkDensity/particleDensity).toFixed(3);
    let voidRatio = (porosity / (1 - porosity)).toFixed(3);
    let CI = (coneForce / coneArea).toFixed(1);
    let stress = ((wheelLoad * 9.81) / contactArea / 100).toFixed(2);

    document.getElementById("ans_porosity").value = porosity;
    document.getElementById("ans_void").value = voidRatio;
    document.getElementById("ans_ci").value = CI;
    document.getElementById("ans_stress").value = stress;

    document.getElementById("in_porosity").value = "";
    document.getElementById("in_void").value = "";
    document.getElementById("in_ci").value = "";
    document.getElementById("in_stress").value = "";
    document.getElementById("result").innerHTML = "";
}

// =====================================================
// =============== AUTO-CHECK ANSWERS ==================
// =====================================================
function checkIntegrated() {

    function check(idInput, idCorrect, label) {
        let user = parseFloat(document.getElementById(idInput).value);
        let correct = parseFloat(document.getElementById(idCorrect).value);

        if (isNaN(user)) return `${label}: ‚ùå No answer<br>`;

        let ok = Math.abs(user - correct) < 0.005;
        return ok
          ? `${label}: ‚úÖ Correct (${correct})<br>`
          : `${label}: ‚ùå Incorrect (Correct = ${correct})<br>`;
    }

    let feedback = "";
    feedback += check("in_porosity", "ans_porosity", "1) Porosity");
    feedback += check("in_void", "ans_void", "2) Void Ratio");
    feedback += check("in_ci", "ans_ci", "3) Cone Index (MPa)");
    feedback += check("in_stress", "ans_stress", "4) Wheel Load Stress (kPa)");

    document.getElementById("result").innerHTML = feedback;
}

// =====================================================
// =============== SUBMIT TO GOOGLE SHEETS =============
// =====================================================
function submitToGoogle() {
  const payload = {
    studentName: document.getElementById("name").value,
    studentID: document.getElementById("id").value,
    porosity: parseFloat(document.getElementById("porosity").value),
    voidRatio: parseFloat(document.getElementById("void").value),
    coneIndex: parseFloat(document.getElementById("cone").value),
    wheelStress: parseFloat(document.getElementById("stress").value),
    bulkDensity: parseFloat(document.getElementById("bulk").value),
    particleDensity: parseFloat(document.getElementById("particle").value),
    coneForce: parseFloat(document.getElementById("force").value),
    wheelLoad: parseFloat(document.getElementById("load").value),
    contactArea: parseFloat(document.getElementById("area").value)
  };

  fetch("https://script.google.com/macros/s/AKfycbyx8F2_O-aquzXgUwEkE_PKUHBpocB8D4d4UVnODxeVIrgRgoA5Cw-dSSyoR8gqfCASpA/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(response => {
    alert(response.message); // ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡πà‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠ ID ‡πÑ‡∏°‡πà‡∏û‡∏ö
  })
  .catch(err => console.error(err));
}


</script>
</head>

<body>

<h1>Integrated Soil Compaction Problem (Randomized)</h1>

<div class="box">

    <h3>Student Information</h3>
    <label>Name:</label><br>
    <input type="text" id="student_name"><br>

    <label>Student ID:</label><br>
    <input type="text" id="student_id"><br><br>

    <button onclick="generateIntegratedProblem()">üé≤ Generate New Problem</button>

    <div class="quiz-box">
        <h3><b>Problem Description</b></h3>
        <p>The following soil and machinery parameters were collected from a field undergoing compaction assessment:</p>

        <ul>
            <li>Bulk density (œÅb): <b><span id="bd_val">‚Äî</span></b> g/cm¬≥</li>
            <li>Particle density (œÅs): <b><span id="pd_val">‚Äî</span></b> g/cm¬≥</li>
            <li>Cone penetration force: <b><span id="cf_val">‚Äî</span></b> N</li>
            <li>Wheel load: <b><span id="wl_val">‚Äî</span></b> kg</li>
            <li>Tire contact area: <b><span id="ca_val">‚Äî</span></b> cm¬≤</li>
        </ul>

        <h3>Tasks</h3>
        <ol>
            <li>Calculate porosity \( n = 1 - \frac{\rho_b}{\rho_s} \)</li>
            <li>Calculate void ratio \( e = \frac{n}{1-n} \)</li>
            <li>Calculate Cone Index \( CI = \frac{F}{A} \) (MPa)</li>
            <li>Calculate wheel-induced stress \( \sigma = \frac{W \cdot 9.81}{A} \) (kPa)</li>
        </ol>

        <h3>Your Answers</h3>

        <label>1) Porosity:</label><br>
        <input type="number" id="in_porosity" step="0.001"><br>

        <label>2) Void Ratio:</label><br>
        <input type="number" id="in_void" step="0.001"><br>

        <label>3) Cone Index (MPa):</label><br>
        <input type="number" id="in_ci" step="0.1"><br>

        <label>4) Wheel Load Stress (kPa):</label><br>
        <input type="number" id="in_stress" step="0.01"><br>

        <button onclick="checkIntegrated()">Check Answers</button>
        <button onclick="submitToGoogle()">üì§ Submit to Google Sheet</button>

        <p id="result"></p>

        <!-- Hidden correct answers -->
        <input type="hidden" id="ans_porosity">
        <input type="hidden" id="ans_void">
        <input type="hidden" id="ans_ci">
        <input type="hidden" id="ans_stress">
    </div>
</div>

</body>
</html>
